<div class="max-w-3xl mx-auto">
    <!-- Create Post -->
    <div *ngIf="currentUser" class="bg-slate-800 rounded-xl p-4 mb-6 border border-slate-700">
        <div class="flex space-x-4">
            <div class="w-12 h-12 bg-slate-600 rounded-full flex-shrink-0 overflow-hidden">
                <img *ngIf="currentUser.profile_image" [src]="currentUser.profile_image" [alt]="currentUser.name"
                    class="w-full h-full object-cover">
            </div>
            <div class="flex-1">
                <textarea [(ngModel)]="newPostContent"
                    class="w-full bg-slate-900 text-white rounded-lg p-3 border border-slate-700 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none resize-none"
                    rows="3" placeholder="Share your training progress, techniques, or thoughts..."></textarea>

                <!-- Media Preview -->
                <div *ngIf="mediaPreview" class="mt-3 relative inline-block">
                    <img *ngIf="!selectedMedia?.type?.startsWith('video')" [src]="mediaPreview"
                        class="max-h-48 rounded-lg border border-slate-700">
                    <video *ngIf="selectedMedia?.type?.startsWith('video')" [src]="mediaPreview"
                        class="max-h-48 rounded-lg border border-slate-700" controls></video>
                    <button (click)="removeMedia()"
                        class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <div class="flex justify-between items-center mt-3">
                    <div class="flex space-x-2 text-slate-400">
                        <input type="file" id="feed-media-input" class="hidden" (change)="onMediaSelect($event)">
                        <button (click)="triggerFileInput('image')"
                            class="hover:text-emerald-400 transition flex items-center space-x-1">
                            <span>üì∑</span> <span class="text-sm">Media</span>
                        </button>
                        <button (click)="triggerFileInput('video')"
                            class="hover:text-emerald-400 transition flex items-center space-x-1">
                            <span>üé•</span> <span class="text-sm">Video</span>
                        </button>
                    </div>
                    <button (click)="createPost()" [disabled]="(!newPostContent && !selectedMedia) || isPosting"
                        class="bg-emerald-500 hover:bg-emerald-600 text-slate-900 font-bold py-2 px-6 rounded-full transition text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        {{ isPosting ? 'Posting...' : 'Post' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Navigation -->
    <div class="flex space-x-4 mb-6 overflow-x-auto pb-2">
        <a routerLink="/app/feed" routerLinkActive="active-nav" [routerLinkActiveOptions]="{exact: true}"
            class="nav-btn bg-slate-800 text-slate-400 border border-slate-700 hover:border-emerald-500/50 hover:text-emerald-400 px-4 py-1 rounded-full text-sm font-medium whitespace-nowrap transition">
            All Posts
        </a>
        <a routerLink="/app/training" routerLinkActive="active-nav"
            class="nav-btn bg-slate-800 text-slate-400 border border-slate-700 hover:border-emerald-500/50 hover:text-emerald-400 px-4 py-1 rounded-full text-sm font-medium whitespace-nowrap transition">
            Training
        </a>
        <a routerLink="/app/highlights" routerLinkActive="active-nav"
            class="nav-btn bg-slate-800 text-slate-400 border border-slate-700 hover:border-emerald-500/50 hover:text-emerald-400 px-4 py-1 rounded-full text-sm font-medium whitespace-nowrap transition">
            Highlights
        </a>
        <a routerLink="/app/strategy" routerLinkActive="active-nav"
            class="nav-btn bg-slate-800 text-slate-400 border border-slate-700 hover:border-emerald-500/50 hover:text-emerald-400 px-4 py-1 rounded-full text-sm font-medium whitespace-nowrap transition">
            Strategy
        </a>
    </div>

    <!-- Posts Feed -->
    <div *ngFor="let post of posts" class="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-slate-600 rounded-full overflow-hidden">
                    <!-- We need to fetch author details or include them in post response. For now, using placeholder or if it's current user -->
                    <!-- Ideally backend should populate author info. Assuming simple display for now -->
                    <div class="w-full h-full bg-slate-500 flex items-center justify-center text-xs text-white">
                        {{ post.author_id.substring(0, 2).toUpperCase() }}
                    </div>
                </div>
                <div>
                    <h3 class="font-bold text-white">{{ post.author_id }}</h3> <!-- Should be author name -->
                    <p class="text-xs text-slate-400 capitalize">{{ post.type }} ‚Ä¢ Recent</p>
                </div>
            </div>
            <button class="text-slate-400 hover:text-white">‚Ä¢‚Ä¢‚Ä¢</button>
        </div>
        <p class="text-slate-300 mb-4 whitespace-pre-wrap">{{ post.content }}</p>

        <!-- Media Display -->
        <div *ngIf="post.media_url"
            class="bg-slate-900 rounded-lg mb-4 overflow-hidden flex items-center justify-center">
            <img *ngIf="post.type === 'image'" [src]="post.media_url" class="max-h-96 w-auto object-contain">
            <video *ngIf="post.type === 'video'" [src]="post.media_url" controls class="max-h-96 w-full"></video>
        </div>

        <div class="flex items-center justify-between text-slate-400 text-sm border-t border-slate-700 pt-4">
            <button class="flex items-center space-x-2 hover:text-emerald-400 transition">
                <span>üëç</span> <span>{{ post.likes }} Likes</span>
            </button>
            <button class="flex items-center space-x-2 hover:text-emerald-400 transition">
                <span>üí¨</span> <span>{{ post.comments }} Comments</span>
            </button>
            <button class="flex items-center space-x-2 hover:text-emerald-400 transition">
                <span>‚ÜóÔ∏è</span> <span>Share</span>
            </button>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-8 text-slate-400">
        Loading posts...
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && posts.length === 0" class="text-center py-8 text-slate-400">
        No posts yet. Be the first to share something!
    </div>
</div>